# JWT

- GenerateToken 生成
- ParseToken 解析
- DeleteToken 删除
- GetAccessToken 获取访问

通过读取config包里面的东西

```yaml
# JWT配置
jwt:
    signingKey: 39c54195e73304e74a8429b178965865
    expiresTime: 7d
    bufferTime: 1d
    issuer: xiujie # 发行人
    
signingKey：用于签名验证的密钥
expiresTime：token有效期为7天
bufferTime：缓冲时间为1天，用于提前刷新token
issuer：指定token发行方为"xiujie"
```





## 登录逻辑

- 先获取ip

- 通过LoginParams 封装logininfor
- 校验验证码 service.SysCaptcha().VerifyCaptcha(ctx, param.CaptchaID, param.CaptchaValue)
- 获取用户信息 service.SysUser().GetUserByUsernameAndPassword(ctx, param.TenantId, param.Username, param.Password)
- 构建临时的上下文
- 生成token
- 保存登录日志
- 保存在线列表

失败为1



## 获取token

从请求头"Authorization"字段或查询参数"access_token"中获取token信息
如果两个地方都为空，则返回错误
优先使用Authorization头中的Bearer token，如果为空则使用查询参数中的token





# 权限

#### 权限码

```go
"cpr:"             // 角色权限码前缀+角色权限
"cpm:"             // 菜单权限码前缀+菜单权限
"cpd:"             // 部门权限码前缀+部门编码
"cpp:"             // 岗位权限码前缀+岗位编码
"cpu:"             // 用户权限码前缀+用户名
"cpc:current:user" // 当前登录用户默认权限
```









# mintior.go

## IMonitorServer获取所有的信息



```go
	GetGoInfo(ctx context.Context) (res *model.GoRunInfo)
	// GetHostInfo 获取主机信息
	GetHostInfo(ctx context.Context) (data []byte)
	// GetSysLoad 获取系统负载信息
	GetSysLoad(ctx context.Context) (data []byte)
	// GetCpuInfo 获取CPU信息
	GetCpuInfo(ctx context.Context) (data []byte)
	// GetMemInfo 获取内存信息
	GetMemInfo(ctx context.Context) (data []byte)
	// GetDiskInfo 获取磁盘信息
	GetDiskInfo(ctx context.Context) (data []byte)
	// GetNetStatusInfo 获取网络信息
	GetNetStatusInfo(ctx context.Context) (data []byte)
```



## 获取电脑信息

>var gm runtime.MemStats 定义一个能够获取电脑信息的结构
>
>runtime.ReadMemStats(&gm)  写入

- 获取主机信息

```go
	hostInfo, _ := host.Info()
	timestamp, _ := host.BootTime()
```