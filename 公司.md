# JWT

- GenerateToken 生成
- ParseToken 解析
- DeleteToken 删除
- GetAccessToken 获取访问

通过读取config包里面的东西

```yaml
# JWT配置
jwt:
    signingKey: 39c54195e73304e74a8429b178965865
    expiresTime: 7d
    bufferTime: 1d
    issuer: xiujie # 发行人
    
signingKey：用于签名验证的密钥
expiresTime：token有效期为7天
bufferTime：缓冲时间为1天，用于提前刷新token
issuer：指定token发行方为"xiujie"
```





## 登录逻辑

- 先获取ip

- 通过LoginParams 封装logininfor
- 校验验证码 service.SysCaptcha().VerifyCaptcha(ctx, param.CaptchaID, param.CaptchaValue)
- 获取用户信息 service.SysUser().GetUserByUsernameAndPassword(ctx, param.TenantId, param.Username, param.Password)
- 构建临时的上下文
- 生成token
- 保存登录日志
- 保存在线列表

失败为1



## 获取token

从请求头"Authorization"字段或查询参数"access_token"中获取token信息
如果两个地方都为空，则返回错误
优先使用Authorization头中的Bearer token，如果为空则使用查询参数中的token





# 权限

#### 权限码

```go
"cpr:"             // 角色权限码前缀+角色权限
"cpm:"             // 菜单权限码前缀+菜单权限
"cpd:"             // 部门权限码前缀+部门编码
"cpp:"             // 岗位权限码前缀+岗位编码
"cpu:"             // 用户权限码前缀+用户名
"cpc:current:user" // 当前登录用户默认权限
```









# mintior.go

## IMonitorServer获取所有的信息



```go
	GetGoInfo(ctx context.Context) (res *model.GoRunInfo)
	// GetHostInfo 获取主机信息
	GetHostInfo(ctx context.Context) (data []byte)
	// GetSysLoad 获取系统负载信息
	GetSysLoad(ctx context.Context) (data []byte)
	// GetCpuInfo 获取CPU信息
	GetCpuInfo(ctx context.Context) (data []byte)
	// GetMemInfo 获取内存信息
	GetMemInfo(ctx context.Context) (data []byte)
	// GetDiskInfo 获取磁盘信息
	GetDiskInfo(ctx context.Context) (data []byte)
	// GetNetStatusInfo 获取网络信息
	GetNetStatusInfo(ctx context.Context) (data []byte)
```



## 获取电脑信息

>var gm runtime.MemStats 定义一个能够获取电脑信息的结构
>
>runtime.ReadMemStats(&gm)  写入

- 获取主机信息

```go
	hostInfo, _ := host.Info()
	timestamp, _ := host.BootTime()
```







1.设备的参数属性从哪里调取？













- [x] 新加字段 登陆时间的字段 gf dao 一下
- [x] 所有的写在一个文件像下面
- [x] uuid32
- [x] view 返回向 要把新嘉的字段 返回  最后登录时间
- [x] defer 不用加







- [ ] 建立机构
- [ ] 建立工厂
- [ ] 工厂&机构绑定
- [ ] 用账号登录 设备设置
- [ ] 生产产品
- [ ] 建立订单
- [ ] 设备上来自动连接打印机
- [ ] 





11.27

- [x] 提交测试

- [ ] 开发中心 产品详情 测试设备 后端接口      郑亚琦\李文斌 

1. 前端给我传SN码

2. 我把SN码插入产品测试设备关联表

3. 前端需要什么  todo 更新数据库!!!

   - |    设备名称    | 设备编码  | MCU固件 | 备注 | 在线状态 | 最后在线时间 | 操作 |
     | :------------: | :-------: | :-----: | :--: | :------: | :----------: | :--: |
     | `product_code` | device_sn |         |      |          |              |      |

- [ ] 开发中心 调试设备开发 设备坐标 后端接口      郑亚琦\李文斌
- [ ] 开发中心 研发分组,研发分组设备列表 后台接口  郑亚琦\李文斌
- [ ] 开发中心 固件升级 任务范围  全部设备\指定分组\指定设备   指定设备内是否勾选测试设备  郑亚琦\李文斌 
- [ ] 开发中心 固件升级 新增升级任务后, 扫描生产的设备表(依赖条件 分组/指定设备/依赖版本/依赖型号 版本<=升级版本), 插入升级明细表 郑亚琦\李文斌 
- [ ] 开发中心 固件升级 升级任务表明细 数字版本   郑亚琦\李文斌

 



```
            {
                "deviceId": 166,
                "deviceName": "1127测试设备",
                "deviceSecret": "049c161d",
                    "deviceSn": "00000054",
                "onlineState": 2,
                "lastOnlineTime": "2025-11-27 15:22:18",
                "lastLoginTime": "2025-11-27 15:12:18",
                "svrCode": "hztcp01",
                "remark": "",
                "deviceParams": "",
                "deviceProperties": "{\"properties\":[{\"key\":\"uartId\",\"value\":\"COM3\",\"time\":1764228138210},{\"key\":\"uartState\",\"value\":\"1\",\"time\":1764228138210},{\"key\":\"uartSendLastTime\",\"value\":\"0\",\"time\":1764228138210},{\"key\":\"uartRecvLastTime\",\"value\":\"0\",\"time\":1764228138210},{\"key\":\"startup\",\"value\":\"600\",\"time\":1764228138210}],\"time\":1764228138210}",
                "tenantId": "000000",
                "createdAt": "2025-11-27 15:02:32"
            },
```

